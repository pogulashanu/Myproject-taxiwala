pipeline {
    agent any

    environment {
        PATH = "/opt/apache-maven-3.9.6/bin:$PATH"
        SONAR_TOKEN = credentials('SONAR_TOKEN')
    }

    stages {
        stage('Build') {
            steps {
                echo "----------- Build Started ----------"
                sh 'mvn clean package'
                echo "----------- Build Completed ----------"
            }
        }

        stage('Publish to Artifactory') {
            steps {
                script {
                    // âœ… Define Artifactory registry URL
                    def registry = 'https://taxi012.jfrog.io/artifactory'

                    // Create Artifactory server using registry URL
                    def server = Artifactory.newServer(
                        url: registry,
                        credentialsId: "jfrog-credentials" // Your Jenkins credentials ID
                    )

                    // Create build info object
                    def buildInfo = Artifactory.newBuildInfo()

                    // Define what to upload
                    def uploadSpec = """{
                        "files": [
                            {
                                "pattern": "target/*.jar",
                                "target": "my-repo/"
                            }
                        ]
                    }"""

                    // Upload artifacts
                    server.upload(uploadSpec, buildInfo)

                    // Publish build info
                    server.publishBuildInfo(buildInfo)

                    echo "----------- Artifacts Published Successfully ----------"
                }
            }
        }
    }
}